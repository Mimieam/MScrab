$(window).load(function(){});$(document).ready(function(){var b=new (function(){this.spacing=5;this.cell_w=70;this.cell_h=70;this.ChipColor="#F2F2F2";this.TilesColor="";
this.left=0;this.top=0;this.Chip={zIndex:"0",position:"relative","float":"left",top:10+this.spacing,left:10+this.spacing,width:this.cell_w,height:this.cell_h,background:this.ChipColor};
this.Tile={zIndex:"0",position:"absolute",width:this.cell_w,height:this.cell_h,background:this.TilesColor,top:this.top,left:this.left};})();Game={};Game.droppedInId;
Game.draggedChipId;Game.selectedChip;Game.tileCnt=0;Game.chipCnt=0;Game.show_props=function(k,j){var i="";for(var l in k){i+=j+"."+l+" = "+k[l]+"\n";}return i;
};Game.validateBoard=function(i){Mimi.equation="";Mimi.equationChip=[];Mimi.validate();};Game.getRandomInt=function(j,i){return Math.floor(Math.random()*(i-j+1))+j;
};Game.getRandomSign=function(){var i="+/*-";var j;j=i.charAt(Math.floor(Math.random()*i.length));return j;};Game.getParentheses=function(i){if(i=="left"){return"(";
}if(i=="right"){return")";}};Game.getBrowserDimension=function(j){var i=630,l=460;if(document.body&&document.body.offsetWidth){i=document.body.offsetWidth;
l=document.body.offsetHeight;}if(document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){i=document.documentElement.offsetWidth;
l=document.documentElement.offsetHeight;}if(window.innerWidth&&window.innerHeight){i=window.innerWidth;l=window.innerHeight;}var k={width:i,height:l};return k;
};Game.viewport=Game.getBrowserDimension();Game.setWorldDim=function(){$(".world").css({width:Game.viewport.width,height:Game.viewport.height,"background-color":"green"});
};function f(j,l){Game.chipCnt++;this.type=j||"regular";this.content=l||0;this.row=null;this.col=null;this.status="active";var i=$("<div />").addClass("chip").css(b.Chip).attr("id","chip_"+Game.chipCnt).addClass("ui-draggable").text(this.content).data({type:this.type,content:this.content,row:this.row,col:this.col,droppedIn:""}).draggable({containment:"#board,#rack",cursor:"move",revert:"invalid"});
function k(){return i;}this.GetSelf=function(){return k();};this.SetRowAndCol=function(n,m){this.row=n;this.col=m;};this.ToJson=function(){return{type:this.type,content:this.content,status:this.status,row:this.row,col:this.col};
};}function d(l,i,j,m){Game.tileCnt++;this.id="tile_"+Game.tileCnt;this.type=m||"normal";this.col=i;this.row=l;this.status=j||"free";var k=$("<div />").addClass("tile").css(b.Tile).addClass("ui-droppable").attr({id:this.id,type:this.type,status:this.status,row:this.row,col:this.col});
function n(){return k;}this.GetSelf=function(){return n();};this.getFullNeighbor=function(){var o=[];};this.makeAllTileDroppable=function(p,o){$(p).droppable({accept:"div.chip",hoverClass:"hovered",drop:function(q,r){r.draggable.attr("data-droppedIn",this.id);
r.draggable.attr("data-row",$(this).attr("row"));r.draggable.attr("data-col",$(this).attr("col"));console.log(r.draggable.attr("id")+" with value: "+r.draggable.data("content")+" is in "+r.draggable.attr("data-droppedIn"));
console.log(r.draggable.attr("data-row")+" - "+r.draggable.attr("data-col"));console.log($(this).attr("col"));console.log($(this).attr("row"));console.log(o.name);
if($.inArray(r.draggable,o.usedChip)==-1){o.usedChip.push(r.draggable);}console.log(o.usedChip.length);console.log(o.usedTile.length);$("#board").on("dblclick",".chip",function(){var s=$(this);
if(s.attr("data-status")!="disabled"){s.attr("data-status","active").attr("data-row",null).attr("data-col",null);$("#rack").append($(this).css({position:"relative"}).detach());
o.usedChip=o.usedChip.filter(function(t){return t.attr("id")==s.attr("id")?false:true;});}});if($(this).children().length==0){r.draggable.css({position:"absolute",left:0+"px",top:0+"px",zIndex:1});
r.draggable.detach();$(this).append(r.draggable);}else{console.log(r.draggable.data());r.draggable.draggable("option","revert",true);}},out:function(q,r){},over:function(q,r){$(this).css({});
}});};}function e(i,l,k,j){this.name=i;this.startPt=l;this.endPt=k;this.Rule=j;}function a(n,m,o,l,j,i,k){this.width=i||$(n).width();this.height=k||$(n).height();
b.cell_h=l||b.cell_h;b.cell_w=j||b.cell_w;this.cnt=0;this.tileSet=[];this.patternStr="";this.cols=o||Math.floor(this.height/b.cell_h);this.rows=m||Math.floor(this.width/b.cell_w);
this.pattern=[[4,0,0,1,0,0,0,4,0,0,0,1,0,0,4],[0,3,0,0,0,2,0,0,0,2,0,0,0,3,0],[0,0,3,0,0,0,1,0,1,0,0,0,3,0,0],[1,0,0,3,0,0,0,1,0,0,0,3,0,0,1],[0,0,0,0,3,0,0,0,0,0,3,0,0,0,0],[0,2,0,0,0,2,0,0,0,2,0,0,0,2,0],[0,0,1,0,0,0,1,0,1,0,0,0,1,0,0],[4,0,0,1,0,0,0,5,0,0,0,1,0,0,4],[0,0,1,0,0,0,1,0,1,0,0,0,1,0,0],[0,2,0,0,0,2,0,0,0,2,0,0,0,2,0],[0,0,0,0,3,0,0,0,0,0,3,0,0,0,0],[1,0,0,3,0,0,0,1,0,0,0,3,0,0,1],[0,0,3,0,0,0,1,0,1,0,0,0,3,0,0],[0,3,0,0,0,2,0,0,0,2,0,0,0,3,0],[4,0,0,1,0,0,0,4,0,0,0,1,0,0,4]];
}a.prototype={buildGrid:function(r,k){var o;var n=[];console.log(console.memory.usedJSHeapSize);console.time("Testing Grid build");for(var m=0;m<this.rows;
m++){for(var l=0;l<this.cols;l++){k.Tile.top=m*(k.cell_w+k.spacing);k.Tile.left=l*(k.cell_w+k.spacing);o=(new d(m,l)).GetSelf();this.applyPattern(o,m,l);
n.push(o[0].outerHTML);this.cnt++;}}console.timeEnd("Testing Grid build");console.log(console.memory.usedJSHeapSize);var q=this.cols*(k.cell_w+k.spacing)-k.spacing+2;
var p=this.rows*(k.cell_h+k.spacing)-k.spacing+2;$(r).css({width:q,height:p});$(r)[0].innerHTML=n.join("");},applyPattern:function(k,j,m){for(var l in this.pattern){for(var i in l){switch(this.pattern[j%14][m%14]){case 0:$(k).addClass("empty");
break;case 1:$(k).addClass("dbl_number").text("x2");break;case 2:$(k).addClass("tpl_number").text("x3");break;case 3:$(k).addClass("dbl_equation").text("+4");
break;case 4:$(k).addClass("tpl_equation").text("+2");break;case 5:$(k).addClass("star").text("x10");break;}}}}};function h(l){var o=[];var j=[];var n=[];
var p;this.DOM_element=l;$(this.DOM_element).css("background-color","red").droppable({accept:"div.chip",hoverClass:"hovered",drop:function(q,r){r.draggable.css({});
q.preventDefault();}});function k(q){o.push(q);}function i(q){j.push(q);}function m(q){if(q){n.push(q);}else{return n.length;}}this.makeNewSet=function(u,t,v){for(var s=o.length||u;
s>0;s--){k(new f("num",Game.getRandomInt(0,9)));}for(var r=j.length||t;r>0;r--){i(new f("Op",Game.getRandomSign()));}for(var q=v;q>0;q--){m(new f("Eq","="));
}};this.getChips=function(){for(var r=o.length-1;r>=0;r--){$(this.DOM_element).append(o[r].GetSelf()[0]);}for(var q in j){$(this.DOM_element).append(j[q].GetSelf()[0]);
}for(var s in n){$(this.DOM_element).append(n[s].GetSelf()[0]);}};this.getSymbols=function(q){if(q=="left-parenthesis"){return((new f("left-parenthesis","(")).GetSelf()[0]);
}if(q=="right-parenthesis"){return((new f("right-parenthesis",")")).GetSelf()[0]);}};this.reset=function(){o=[];j=[];n=[];p=null;$(this.DOM_element).empty();
};}var g=function(k,m){this.name=k;var n=0;this.home=m;this.Move="";this.equation="";this.equationChip=[];this.usedChip=[];this.usedTile=[];this.rack=new h("#rack");
this.rack.makeNewSet(5,2,1);this.rack.getChips();$("#rack").append(this.rack.getSymbols("left-parenthesis"));$("#rack").append(this.rack.getSymbols("right-parenthesis"));
function l(){return n;}function j(o){n+=o;}this.getScore=function(){return"you've got "+l()+" points";};this.setScore=function(o){j(o);};this.findHome=function(){return this.home;
};this.printUsedTile=function(q){var p="";for(var o=this.usedChip.length-1;o>=0;o--){p+=" "+$(this.usedChip[o]).html();}return p;};function i(o,p){var q=parseInt($(p).attr("data-row"),10);
var r=parseInt($(p).attr("data-col"),10);switch(o){case"left":return $(".chip[data-row="+q+"][data-col="+(r-1)+"]");case"right":return $(".chip[data-row="+q+"][data-col="+(r+1)+"]");
case"top":return $(".chip[data-row="+(q-1)+"][data-col="+r+"]");case"bottom":return $(".chip[data-row="+(q+1)+"][data-col="+r+"]");}}this.degradingRadiant=function(o,A){var r=parseInt(o,16)>>16;
var y=(parseInt(o,16)>>8)&255;var t=parseInt(o,16)&255;var p=A;var q=16777215>>16;var w=(16777215>>8)&255;var s=16777215&255;var x=p*r+(1-p)*q;var u=p*y+(1-p)*w;
var v=p*t+(1-p)*s;var z="#"+((1<<24)+(x<<16)+(u<<8)+v).toString(16).substr(1);return z;};this.lpcnt=0;this.traverseUsedChip=function(s,p,o){var r=o;this.lpcnt+=0.3;
if(r[0]===undefined){return 0;}else{var q;if(s=="horizontal"){r.css({"background-color":"chocolate"});console.log("orientation "+p);if(p=="left"){this.traverseUsedChip(s,p,i(p,o));
console.log(this.equation+=r.html()+"|");this.equationChip.push(r);}if(p=="right"){this.equationChip.push(r);console.log(this.equation+=r.html()+"|");this.traverseUsedChip(s,p,i(p,o));
}}else{if(s=="vertical"){if(p=="top"){this.traverseUsedChip(s,p,i(p,o));this.equationChip.push(r);console.log(this.equation+=r.html()+"|");}if(p=="bottom"){this.equationChip.push(r);
console.log(this.equation+=r.html()+"|");this.traverseUsedChip(s,p,i(p,o));}}}}};this.validate=function(){if(this.usedChip.length===0){return -1;}else{var t="";
var r=i("left",(this.usedChip[this.usedChip.length-1]))||null;var s=i("right",(this.usedChip[this.usedChip.length-1]))||null;var p=i("top",(this.usedChip[this.usedChip.length-1]))||null;
var u=i("bottom",(this.usedChip[this.usedChip.length-1]))||null;console.log("last used CHip :"+this.usedChip[this.usedChip.length-1].html());if((r.length===0?(s.length===0?false:true):true)){t="horizontal";
this.traverseUsedChip(t,"left",r);this.equationChip.push(this.usedChip[this.usedChip.length-1]);console.log(this.equation+=$(this.usedChip[this.usedChip.length-1]).html()+"|");
this.traverseUsedChip(t,"right",s);}else{if((p.length===0?(u.length===0?false:true):true)){t="vertical";this.traverseUsedChip(t,"top",p);this.equationChip.push(this.usedChip[this.usedChip.length-1]);
console.log(this.equation+=$(this.usedChip[this.usedChip.length-1]).html()+"|");this.traverseUsedChip(t,"bottom",u);}}}console.log("let's parse the equation: ");
var q=this.equation.replace(/\|/g,"");console.log(q);var o=this.parseEquation(q);console.log(o);if(1){this.rack.reset();this.disable_on_validation();this.rack.makeNewSet(5,2,1);
this.rack.getChips();}this.equation="";console.log(this.equationChip);this.equationChip=[];};this.disable_on_validation=function(){for(var o=0;o<this.equationChip.length;
o++){this.equationChip[o].draggable("disable").css({opacity:0.9,"background-color":"gray","border-color":"dark-gray"});this.equationChip[o].attr("data-status","disabled");
this.equationChip[o].unbind("dblclick");}};this.parseEquation=function(o){return EquationParser.parse(o);};};Mimi=new g("Mimi");var c=new a("#board",30,30);
c.buildGrid("#board",b);Game.setWorldDim();$("#board").draggable();(new d(0,0)).makeAllTileDroppable(".tile",Mimi);});